!function(t){"use strict";var e=function(){var e;return e=t("<div></div>").css(["color"]).color,"undefined"!=typeof e?function(t,e){return t.css(e)}:function(e,r){var a;return a={},t.each(r,function(t,r){a[r]=e.css(r)}),a}}(),r={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"},a=/[&<>"'\/]/g,i=function(t){return"undefined"!=typeof t?t.replace(a,function(t){return r[t]}):void 0},n=function(){function r(r){var i,l;l=r.css("position"),"static"===l&&(l="relative"),i=t(a.wrapper).css(t.extend({},n.wrapper,e(r,s),{position:l})),this.textareaTop=parseInt(r.css("border-top-width")),this.$el=t(a.overlay).css(t.extend({},n.overlay,e(r,o),{top:this.textareaTop,right:parseInt(r.css("border-right-width")),bottom:parseInt(r.css("border-bottom-width")),left:parseInt(r.css("border-left-width"))})),this.$textarea=r.css(n.textarea),this.$textarea.wrap(i).before(this.$el),this.$textarea.origVal=r.val,this.$textarea.val=t.proxy(this.val,this),this.$textarea.on({"input.overlay":t.proxy(this.onInput,this),"change.overlay":t.proxy(this.onInput,this),"scroll.overlay":t.proxy(this.resizeOverlay,this),"resize.overlay":t.proxy(this.resizeOverlay,this)}),this.strategies=[]}var a,n,s,o;return a={wrapper:'<div class="textoverlay-wrapper"></div>',overlay:'<div class="textoverlay"></div>'},n={wrapper:{margin:0,padding:0,overflow:"hidden"},overlay:{position:"absolute",color:"transparent","white-space":"pre-wrap","word-wrap":"break-word",overflow:"hidden"},textarea:{background:"transparent",position:"relative",outline:0}},s=["display"],o=["margin-top","margin-right","margin-bottom","margin-left","padding-top","padding-right","padding-bottom","padding-left","font-family","font-weight","font-size","background-color"],t.extend(r.prototype,{val:function(t){return null==t?this.$textarea.origVal():this.setVal(t)},setVal:function(t){return this.$textarea.origVal(t),this.renderTextOnOverlay(),this.$textarea},onInput:function(t){this.renderTextOnOverlay()},renderTextOnOverlay:function(){var e,r,a,n,s,o;for(e=t("<div></div>").text(this.$textarea.val()),r=0,a=this.strategies.length;a>r;r++)n=this.strategies[r],s=n.match,t.isArray(s)&&(s=t.map(s,function(t){return t.replace(/(\(|\)|\|)/g,"$1")}),s=new RegExp("("+s.join("|")+")","g")),o="background-color:"+n.css["background-color"],e.contents().each(function(){var e,r,a,n;if(this.nodeType==Node.TEXT_NODE){for(e=this.textContent,r="",n=s.lastIndex=0;;n=s.lastIndex){if(a=s.exec(e),!a){n&&(r+=i(e.substr(n)));break}a=a[0],r+=i(e.substr(n,s.lastIndex-n-a.length)),r+='<span style="'+o+'">'+i(a)+"</span>"}n&&t(this).replaceWith(r)}});return this.$el.html(e.contents()),this},resizeOverlay:function(){this.$el.css({top:this.textareaTop-this.$textarea.scrollTop()})},register:function(e){return e=t.isArray(e)?e:[e],this.strategies=this.strategies.concat(e),this.renderTextOnOverlay()},destroy:function(){var t;this.$textarea.off(".overlay"),t=this.$textarea.parent(),t.after(this.$textarea).remove(),this.$textarea.removeData("overlay"),this.$textarea=null}}),r}();t.fn.overlay=function(e){var r;return r="overlay","destroy"===e?this.each(function(){var e=t(this).data(r);e&&e.destroy()}):this.each(function(){var a,i;a=t(this),i=a.data(r),i||(i=new n(a),a.data(r,i)),i.register(e)})}}(window.jQuery);